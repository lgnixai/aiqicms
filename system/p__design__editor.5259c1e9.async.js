"use strict";(self.webpackChunkAnQiCMS=self.webpackChunkAnQiCMS||[]).push([[2376],{19830:function(We,U,a){a.d(U,{Z:function(){return le}});var ae=a(82092),y=a.n(ae),ie=a(48305),E=a.n(ie),V=a(75271),u=a(82187),Y=a.n(u),se=a(27806),p=a(52676),re=function(g){var S=(0,V.useState)(!1),$=E()(S,2),C=$[0],K=$[1];(0,V.useEffect)(function(){K(g.open||!1)},[]);var z=function(){K(!C)},R=Y()(y()(y()({},"collaspe-item",!0),"collaspe-item-active",C),g.className);return(0,p.jsxs)("div",{className:R,style:g.style,children:[(0,p.jsxs)("div",{className:"collaspe-header",onClick:z,children:[g.showArrow&&(0,p.jsx)(se.Z,{className:"collaspe-icon"}),(0,p.jsx)("div",{className:"collaspe-header-text",children:g.header}),g.extra&&(0,p.jsx)("div",{className:"collaspe-extra",children:g.extra})]}),(0,p.jsx)("div",{className:"collaspe-content",children:g.children})]})},le=re},81381:function(We,U,a){a.r(U),a.d(U,{default:function(){return nt}});var ae=a(90228),y=a.n(ae),ie=a(87999),E=a.n(ie),V=a(48305),u=a.n(V),Y=a(19830),se=a(75304),p=a(63453),re=a(96570),le=a(18640),v=a(32064),g=a(34206),S=a(54203),$=a(53745),C=a(47634),K=a(91827),z=a(59124),R=a(48806),oe=a(73615),Je=a(31751),be=a(15947),Le=a(16483),qe=a.n(Le),o=a(75271),de=a(27669),t=a(52676),_e=function(k){var X=(0,o.useState)(""),d=u()(X,2),G=d[0],Q=d[1],W=(0,v.useIntl)();(0,o.useEffect)(function(){Q(k.versionCode)},[]);var T=function(){},ce=function(w){G!==w&&Q(w)},ue=function(){var w;(w=k.onFinished)===null||w===void 0||w.call(k,G)};return(0,t.jsx)(S.Z,{title:W.formatMessage({id:"design.history.name"}),open:k.open,onCancel:function(){k.onCancel()},onOk:function(){ue()},width:1e3,children:(0,t.jsx)(de.Xq,{width:"950",height:"600",language:k.language,original:k.originCode,value:G,options:{selectOnLineNumbers:!1,renderSideBySide:!1,automaticLayout:!0,wordWrap:"on"},onChange:ce,editorDidMount:T})})},et=_e,Yt=a(8600),O="",B,tt=function(){var k=(0,o.useState)({}),X=u()(k,2),d=X[0],G=X[1],Q=(0,o.useState)({}),W=u()(Q,2),T=W[0],ce=W[1],ue=(0,o.useState)(!1),F=u()(ue,2),w=F[0],he=F[1],it=(0,o.useState)(""),pe=u()(it,2),J=pe[0],xe=pe[1],b=(0,o.useRef)(),st=(0,o.useState)(!1),je=u()(st,2),rt=je[0],Se=je[1],lt=(0,o.useState)(0),ye=u()(lt,2),ot=ye[0],dt=ye[1],ct=(0,o.useState)([]),Ce=u()(ct,2),ut=Ce[0],ht=Ce[1],ft=(0,o.useState)([]),ke=u()(ft,2),gt=ke[0],vt=ke[1],mt=(0,o.useState)(!1),Me=u()(mt,2),Ze=Me[0],fe=Me[1],pt=(0,o.useState)(""),Oe=u()(pt,2),xt=Oe[0],jt=Oe[1],St=(0,o.useState)([]),we=u()(St,2),Te=we[0],Fe=we[1],yt=(0,o.useState)([]),De=u()(yt,2),Ne=De[0],He=De[1],Ct=(0,o.useState)(!1),Ae=u()(Ct,2),kt=Ae[0],L=Ae[1],Mt=(0,o.useState)(),Pe=u()(Mt,2),q=Pe[0],Zt=Pe[1],Ot=(0,o.useState)(!1),Re=u()(Ot,2),Ie=Re[0],ge=Re[1],wt=(0,o.useState)({}),Ee=u()(wt,2),I=Ee[0],Tt=Ee[1],Ft=(0,o.useState)(""),$e=u()(Ft,2),ze=$e[0],Be=$e[1],l=(0,v.useIntl)(),_=!1,ee=function(){var i=E()(y()().mark(function e(n){var s,r;return y()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:s=new URLSearchParams(window.location.search),r=s.get("package")||"",Se(!1),(0,p.jz)({package:r,type:O,path:n}).then(function(D){var N;G(D.data),xe(D.data.content||""),Se(!0),(N=b.current)===null||N===void 0||N.reload()}).catch(function(){g.ZP.error(l.formatMessage({id:"design.editor.get.error"}))});case 4:case"end":return c.stop()}},e)}));return function(n){return i.apply(this,arguments)}}(),Dt=function(){var i=E()(y()().mark(function e(){var n,s;return y()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:n=new URLSearchParams(window.location.search),s=n.get("package")||"",(0,p.io)({package:s}).then(function(c){var D;ce(c.data);var N=n.get("path")||"",Qe=n.get("type")||"";O=Qe+"",N===""&&((D=c.data.tpl_files)===null||D===void 0?void 0:D.length)>0&&(Qe="template",N=c.data.tpl_files[0].path);var te=[],Gt=function(){var m=c.data.tpl_files[me].path,x=c.data.tpl_files[me].remark,f=m.split("/");if(f.length>1){var H=f[0],A=f.length>2?f[0]+"/"+f[1]:null,j=te.find(function(P){return P.key===H});if(j||(j={key:H,title:H,children:[]},te.push(j)),A&&f.length>2){var Z=j.children.find(function(P){return P.key===A});Z||(Z={key:A,title:f[1],children:[]},j.children.push(Z)),Z.children.push({key:m,path:m,remark:x,title:(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"name",children:f.slice(2).join("/")}),(0,t.jsx)("div",{className:"extra",children:x})]})})}else j.children.push({key:m,path:m,remark:x,title:(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"name",children:f.slice(1).join("/")}),(0,t.jsx)("div",{className:"extra",children:x})]})})}else te.push({path:m,remark:x,title:(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"name",children:m}),(0,t.jsx)("div",{className:"extra",children:x})]}),key:me})};for(var me in c.data.tpl_files)Gt();ht(te);var ne=[],Ut=function(){if(c.data.static_files[M].path.indexOf(".js")!==-1||c.data.static_files[M].path.indexOf(".ts")!==-1||c.data.static_files[M].path.indexOf(".css")!==-1||c.data.static_files[M].path.indexOf(".scss")!==-1||c.data.static_files[M].path.indexOf(".sass")!==-1||c.data.static_files[M].path.indexOf(".less")!==-1){var m=c.data.static_files[M].path,x=c.data.static_files[M].remark,f=m.split("/");if(f.length>1){var H=f[0],A=f.length>2?f[0]+"/"+f[1]:null,j=ne.find(function(P){return P.key===H});if(j||(j={key:H,title:H,children:[]},ne.push(j)),A&&f.length>2){var Z=j.children.find(function(P){return P.key===A});Z||(Z={key:A,title:f[1],children:[]},j.children.push(Z)),Z.children.push({key:m,path:m,remark:x,title:(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"name",children:f.slice(2).join("/")}),(0,t.jsx)("div",{className:"extra",children:x})]})})}else j.children.push({key:m,path:m,remark:x,title:(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"name",children:f.slice(1).join("/")}),(0,t.jsx)("div",{className:"extra",children:x})]})})}else ne.push({path:m,remark:x,title:(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"name",children:m}),(0,t.jsx)("div",{className:"extra",children:x})]}),key:M})}};for(var M in c.data.static_files)Ut();vt(ne),ee(N)}).catch(function(){g.ZP.error(l.formatMessage({id:"design.editor.get.error"}))});case 3:case"end":return h.stop()}},e)}));return function(){return i.apply(this,arguments)}}(),ve=function(){var e,n=((e=window)===null||e===void 0?void 0:e.innerHeight)-260;n<450?n=450:n>900&&(n=900),dt(n)};(0,o.useEffect)(function(){return Dt(),ve(),window.addEventListener("resize",ve),function(){window.removeEventListener("resize",ve)}},[]);var Nt=function(){q||(0,se.eXu)().then(function(e){Zt(e.data||null)})},Ht=function(e){e.createContextKey("showTplHelperAction",!0),e.addAction({id:"tpl-helper",label:l.formatMessage({id:"design.editor.helper"}),precondition:"showTplHelperAction",contextMenuGroupId:"navigation",contextMenuOrder:1.5,run:function(s){B=s,L(!0),Nt()}})},Ge=function(e){J!==e&&(xe(e),_=!0)},Ue=function(){d.content=J,d.package=T.package,d.update_content=!0,d.type=O,_=!1;var e=g.ZP.loading(l.formatMessage({id:"setting.system.submitting"}),0);(0,p.bk)(d).then(function(n){var s;g.ZP.info(n.msg),(s=b.current)===null||s===void 0||s.reload()}).finally(function(){e()})},Ve=function(){window.scrollTo(window.pageXOffset,0)},Ye=function(e,n){_?S.Z.confirm({title:l.formatMessage({id:"design.editor.confirm-giveup"}),content:l.formatMessage({id:"design.editor.confirm-giveup.content"}),onOk:function(){O=e,ee(n.path),Ve()}}):(O=e,ee(n.path),Ve())},At=function(e){(0,p.sx)({hash:e.hash,package:T.package,path:d.path,type:O}).then(function(n){n.code!==0?g.ZP.error(n.msg):(jt(n.data),fe(!0))})},Pt=function(e){S.Z.confirm({title:l.formatMessage({id:"design.editor.confirm-restore"}),content:l.formatMessage({id:"design.editor.confirm-restore.content"}),onOk:function(){var s=g.ZP.loading(l.formatMessage({id:"setting.system.submitting"}),0);(0,p.wc)({hash:e.hash,package:T.package,path:d.path,type:O}).then(function(r){g.ZP.info(r.msg),ee(e.path)}).finally(function(){s()})}})},Rt=function(e){S.Z.confirm({title:l.formatMessage({id:"design.editor.history.confirm-delete"}),onOk:function(){var s=g.ZP.loading(l.formatMessage({id:"setting.system.submitting"}),0);(0,p.eU)({hash:e.hash,package:T.package,path:d.path,type:O}).then(function(r){var h;g.ZP.info(r.msg),(h=b.current)===null||h===void 0||h.reload()}).finally(function(){s()})}})},It=function(e){e.key==="s"&&(e.ctrlKey||e.metaKey)&&(Ue(),e.preventDefault())},Et=function(){_?S.Z.confirm({title:l.formatMessage({id:"design.editor.confirm-goback"}),content:l.formatMessage({id:"design.editor.confirm-giveup.content"}),onOk:function(){v.history.back()}}):v.history.back()},$t=function(e){return e<500?e+"B":e<1024*1024?(e/1024).toFixed(2)+"KB":(e/1024/1024).toFixed(2)+"MB"},Ke=function(e){return e.indexOf(".html")!==-1?"html":e.indexOf(".css")!==-1?"css":e.indexOf(".yml")!==-1?"yaml":"javascript"},Xe=function(e,n){n&&(e.link=n),Tt(e),Be(e.code),ge(!0)},zt=function(){if(B){var e,n=B.getPosition();(e=B)===null||e===void 0||e.executeEdits("",[{range:new de.Fd.Range(n.lineNumber,n.column,n.lineNumber,n.column),text:ze}]),B.focus()}ge(!1),L(!1)},Bt=[{title:"Hash",dataIndex:"hash"},{title:l.formatMessage({id:"design.size"}),dataIndex:"size",render:function(e){return(0,t.jsx)("div",{children:$t(e)})}},{title:l.formatMessage({id:"design.update-time"}),dataIndex:"last_mod",render:function(e){return qe()(e*1e3).format("YYYY-MM-DD HH:mm")}},{title:l.formatMessage({id:"setting.action"}),key:"action",width:110,render:function(e,n){return(0,t.jsxs)($.Z,{size:12,children:[(0,t.jsx)(C.ZP,{type:"link",onClick:function(){At(n)},children:(0,t.jsx)(v.FormattedMessage,{id:"design.compare"})}),(0,t.jsx)(C.ZP,{type:"link",onClick:function(){Pt(n)},children:(0,t.jsx)(v.FormattedMessage,{id:"design.restore"})}),(0,t.jsx)(C.ZP,{danger:!0,type:"link",onClick:function(){Rt(n)},children:(0,t.jsx)(v.FormattedMessage,{id:"setting.system.delete"})})]})}}];return(0,t.jsxs)(re._z,{title:(0,t.jsxs)("div",{children:[(0,t.jsx)(v.FormattedMessage,{id:"design.editing"}),": ",d==null?void 0:d.path]}),children:[(0,t.jsx)(K.Z,{className:"design-editor-card",children:(0,t.jsxs)(z.Z,{gutter:16,children:[(0,t.jsxs)(R.Z,{sm:18,xs:24,children:[(0,t.jsx)("div",{className:"code-editor-box",onKeyDown:It,children:rt&&(0,t.jsx)(de.ZP,{height:ot,language:Ke((d==null?void 0:d.path)||""),theme:"vs-dark",value:J,options:{selectOnLineNumbers:!1,wordWrap:"on"},onChange:Ge,editorDidMount:Ht})}),(0,t.jsx)("div",{className:"mt-normal",children:(0,t.jsxs)($.Z,{size:16,children:[(0,t.jsx)(C.ZP,{type:"primary",onClick:function(){Ue()},children:(0,t.jsx)(v.FormattedMessage,{id:"design.save"})}),(0,t.jsx)(C.ZP,{onClick:Et,children:(0,t.jsx)(v.FormattedMessage,{id:"design.back"})}),(0,t.jsx)(C.ZP,{onClick:function(){he(!0)},children:(0,t.jsx)(v.FormattedMessage,{id:"design.history.view"})}),(0,t.jsx)("div",{className:"text-muted",children:(0,t.jsx)(v.FormattedMessage,{id:"design.editor.tips"})})]})})]}),(0,t.jsxs)(R.Z,{sm:6,xs:24,children:[(0,t.jsx)(Y.Z,{className:"tpl-file-list",showArrow:!1,open:!0,header:l.formatMessage({id:"design.tempalte.name"}),children:(0,t.jsx)(oe.Z,{showLine:!0,showIcon:!1,expandedKeys:Te,onSelect:function(e,n){if(n.node.children){var s=n.node.key,r=Te.flat(),h=r.indexOf(s);h===-1?r.push(s):r.splice(h,1),Fe(r);return}Ye("template",n.node)},onExpand:function(e){Fe(e)},treeData:ut})},"1"),(0,t.jsx)(Y.Z,{className:"tpl-file-list",showArrow:!1,header:l.formatMessage({id:"design.static.name"}),children:(0,t.jsx)(oe.Z,{showLine:!0,showIcon:!1,expandedKeys:Ne,onSelect:function(e,n){if(n.node.children){var s=n.node.key,r=Ne.flat(),h=r.indexOf(s);h===-1?r.push(s):r.splice(h,1),He(r);return}Ye("static",n.node)},onExpand:function(e){console.log(e),He(e)},treeData:gt})},"2")]})]})}),(0,t.jsx)(S.Z,{title:l.formatMessage({id:"design.history.name"}),open:w,onCancel:function(){he(!1)},onOk:function(){he(!1)},width:800,children:(0,t.jsx)(le.Z,{headerTitle:l.formatMessage({id:"design.manage.name"}),actionRef:b,rowKey:"path",search:!1,toolBarRender:!1,request:function(){var i=E()(y()().mark(function e(n){return y()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n.package=T.package,n.path=d.path,r.abrupt("return",(0,p.TU)(n));case 3:case"end":return r.stop()}},e)}));return function(e){return i.apply(this,arguments)}}(),columnsState:{persistenceKey:"design-file-history-table",persistenceType:"localStorage"},columns:Bt,pagination:{showSizeChanger:!0}})}),Ze&&(0,t.jsx)(et,{open:Ze,originCode:xt,language:Ke((d==null?void 0:d.path)||""),versionCode:J,onCancel:function(){return fe(!1)},onFinished:function(e){Ge(e),fe(!1)}}),(0,t.jsx)(S.Z,{open:kt,onCancel:function(){L(!1)},onOk:function(){L(!1)},width:800,children:q==null?void 0:q.map(function(i,e){var n;return(0,t.jsxs)("div",{className:"design-helper",children:[(0,t.jsx)("h3",{className:"helper-header",children:i.title}),(0,t.jsx)(z.Z,{gutter:16,wrap:!0,children:(n=i.docs)===null||n===void 0?void 0:n.map(function(s,r){return(0,t.jsx)(R.Z,{children:s.docs?(0,t.jsx)(Je.Z,{content:(0,t.jsx)("div",{className:"helper-popover",children:(0,t.jsx)(z.Z,{gutter:16,wrap:!0,children:s.docs.map(function(h,c){return(0,t.jsx)(R.Z,{children:(0,t.jsx)("span",{className:"popover-item link",onClick:function(){return Xe(h,h.link||s.link)},children:h.title})},c)})})}),trigger:"click",children:(0,t.jsx)("span",{className:"helper-item",children:s.title})}):(0,t.jsx)("span",{className:"helper-item link",onClick:function(){return Xe(s,s.link)},children:s.title})},r)})})]},e)})}),(0,t.jsxs)(S.Z,{title:l.formatMessage({id:"design.segment.name"}),open:Ie,onCancel:function(){ge(!1)},okText:l.formatMessage({id:"design.insert"}),onOk:zt,width:600,children:[(I.content||I.link)&&(0,t.jsxs)("div",{className:"helper-code-desc",children:[I.content&&(0,t.jsxs)("span",{children:[(0,t.jsx)(v.FormattedMessage,{id:"design.explain"}),": ",I.content]}),I.link&&(0,t.jsx)("a",{href:I.link,target:"_blank",rel:"noreferrer",children:(0,t.jsx)(v.FormattedMessage,{id:"design.view-doc"})})]}),Ie&&(0,t.jsx)(be.Z.TextArea,{placeholder:l.formatMessage({id:"design.segment.name"}),rows:10,value:ze,onChange:function(e){return Be(e.target.value)}})]})]})},nt=tt},8600:function(){}}]);
