"use strict";(self.webpackChunkAnQiCMS=self.webpackChunkAnQiCMS||[]).push([[9706],{85606:function(N,y,n){var R=n(48305),v=n.n(R),k=n(75304),M=n(22683),A=n(96570),C=n(75271),K=n(52676),g=function(D){var B=(0,C.useState)(void 0),l=v()(B,2),f=l[0],o=l[1],c=(0,C.useState)(""),O=v()(c,2),I=O[0],b=O[1],Z=function(){(0,k.roP)({type:"multi"}).then(function(u){var r=(u.data||[]).map(function(h){return{key:h.id,tab:h.name,is_main:h.is_main}});o(r);var p=(0,M.KJ)("sub-site-id");!p&&r.length>0&&(p=r[0].key+"");var E=r.find(function(h){return h.key===Number(p)}),P=!1;E&&(P=!0,E.is_main&&(P=!1)),(0,M.Xq)("is-sub-site",P),b(p)})};(0,C.useEffect)(function(){Z()},[]);var j=function(u){var r;b(u),(0,M.Xq)("sub-site-id",u);var p=f.find(function(P){return P.key===Number(u)}),E=!0;p.is_main&&(E=!1),(0,M.Xq)("is-sub-site",E),(r=D.onTabChange)===null||r===void 0||r.call(D,u,E)};return(0,K.jsx)(A._z,{tabList:f,tabActiveKey:I,onTabChange:j,title:D.title,children:D.children})};y.Z=g},3797:function(N,y,n){n.r(y);var R=n(90228),v=n.n(R),k=n(87999),M=n.n(k),A=n(48305),C=n.n(A),K=n(85606),g=n(75304),W=n(18640),D=n(35937),B=n(96640),l=n(32064),f=n(54203),o=n(34206),c=n(47634),O=n(37697),I=n(53745),b=n(12964),Z=n(48782),j=n(75271),e=n(52676),u=!1,r=!1,p=function(){var P=(0,j.useState)(!1),h=C()(P,2),S=h[0],U=h[1],T=(0,j.useRef)(),$=(0,j.useState)(""),F=C()($,2),G=F[0],X=F[1],a=(0,l.useIntl)(),Q=function(s){X(s)},V=function(s){f.Z.confirm({title:a.formatMessage({id:"design.confirm-enable"}),onOk:function(){var d=o.ZP.loading(a.formatMessage({id:"design.switching-template"}),0);(0,g.m1B)({package:s.package}),setTimeout(function(){var m;d(),(m=T.current)===null||m===void 0||m.reload()},2e3)}})},Y=function(s){l.history.push("/design/detail?package="+s.package)},w=function(s){l.history.push("/design/editor?package="+s.package)},J=function(s){if(s==="default"){o.ZP.error(a.formatMessage({id:"design.cannot-delete"}));return}f.Z.confirm({title:a.formatMessage({id:"design.confirm-delete"}),onOk:function(){var d=o.ZP.loading(a.formatMessage({id:"setting.system.submitting"}),0);(0,g.bFe)({package:s}).then(function(m){var i;o.ZP.info(m.msg),(i=T.current)===null||i===void 0||i.reload()}).finally(function(){d()})}})},L=function(s,t){var d=new FormData;d.append("cover",t),d.append("file",s.file);var m=o.ZP.loading(a.formatMessage({id:"setting.system.submitting"}),0);(0,g.K6G)(d).then(function(i){if(i.code!==0)o.ZP.info(i.msg);else{var x;o.ZP.info(i.msg||a.formatMessage({id:"setting.system.upload-success"})),U(!1),(x=T.current)===null||x===void 0||x.reload()}}).finally(function(){m()})},H=function(){var _=M()(v()().mark(function s(t){var d;return v()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,(0,g.K4c)({package:t.file.name.replace(".zip","")});case 3:d=i.sent,d.code!==0?f.Z.confirm({title:a.formatMessage({id:"design.data.confirm-upload"}),onOk:function(){L(t,"new")},okText:a.formatMessage({id:"design.data.confirm.new"}),footer:function(te,z){var ae=z.OkBtn,ne=z.CancelBtn;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ne,{}),(0,e.jsx)(c.ZP,{onClick:function(){f.Z.destroyAll(),L(t,"cover")},children:a.formatMessage({id:"design.data.confirm.cover"})}),(0,e.jsx)(ae,{})]})}}):L(t,""),i.next=10;break;case 7:i.prev=7,i.t0=i.catch(0),o.ZP.error(i.t0);case 10:case"end":return i.stop()}},s,null,[[0,7]])}));return function(t){return _.apply(this,arguments)}}(),q=function(s){f.Z.confirm({title:a.formatMessage({id:"design.data.confirm-install"}),width:480,content:(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{children:a.formatMessage({id:"design.data.tips1"})}),(0,e.jsx)("p",{children:a.formatMessage({id:"design.data.tips2"})}),(0,e.jsx)("p",{children:a.formatMessage({id:"design.data.tips3"})}),(0,e.jsxs)("div",{children:[(0,e.jsxs)(O.Z,{value:!0,onChange:function(d){u=d.target.checked},children:[(0,e.jsx)("span",{className:"text-red",children:"*"}),a.formatMessage({id:"design.data.auto-backup"})]}),(0,e.jsxs)(O.Z,{value:!0,onChange:function(d){r=d.target.checked,r&&(u=!0)},children:[(0,e.jsx)("span",{className:"text-red",children:"*"}),a.formatMessage({id:"design.data.auto-clean"})]})]})]}),onOk:function(){var d=o.ZP.loading(a.formatMessage({id:"setting.system.submitting"}),0);(0,g.YnD)({package:s.package,auto_backup:u,auto_cleanup:r}).then(function(m){var i;o.ZP.info(m.msg),(i=T.current)===null||i===void 0||i.reload()}).finally(function(){d()})}})},ee=[{title:a.formatMessage({id:"design.data.name"}),dataIndex:"name"},{title:a.formatMessage({id:"design.data.package"}),dataIndex:"package"},{title:a.formatMessage({id:"setting.system.template-type"}),dataIndex:"template_type",valueEnum:{0:a.formatMessage({id:"setting.system.template-type.auto"}),1:a.formatMessage({id:"setting.system.template-type.code"}),2:a.formatMessage({id:"setting.system.template-type.pc-m"})}},{title:a.formatMessage({id:"website.status"}),dataIndex:"status",valueEnum:{0:{text:a.formatMessage({id:"design.data.notenable"}),status:"Default"},1:{text:a.formatMessage({id:"design.data.enable"}),status:"Success"}}},{title:a.formatMessage({id:"account.time"}),dataIndex:"created"},{title:a.formatMessage({id:"setting.action"}),key:"action",width:300,render:function(s,t){return(0,e.jsxs)(I.Z,{size:16,children:[t.status!==1&&(0,e.jsx)(c.ZP,{type:"link",onClick:function(){V(t)},children:(0,e.jsx)(l.FormattedMessage,{id:"design.data.enable.action"})}),t.preview_data&&t.status===1&&(0,e.jsx)(b.Z,{title:a.formatMessage({id:"design.data.install.example"}),children:(0,e.jsx)(c.ZP,{type:"link",onClick:function(){q(t)},children:(0,e.jsx)(l.FormattedMessage,{id:"design.data.initial"})})}),(0,e.jsx)(c.ZP,{type:"link",onClick:function(){Y(t)},children:(0,e.jsx)(l.FormattedMessage,{id:"design.data.manage"})}),(0,e.jsx)(c.ZP,{type:"link",onClick:function(){w(t)},children:(0,e.jsx)(l.FormattedMessage,{id:"setting.action.edit"})}),t.package!=="default"&&(0,e.jsx)(c.ZP,{danger:!0,type:"link",onClick:function(){J(t.package)},children:(0,e.jsx)(l.FormattedMessage,{id:"setting.system.delete"})})]})}}];return(0,e.jsxs)(K.Z,{onTabChange:function(s){return Q(s)},children:[(0,e.jsx)(W.Z,{headerTitle:a.formatMessage({id:"design.list"}),toolBarRender:function(){return[(0,e.jsx)(c.ZP,{onClick:function(){U(!0)},children:(0,e.jsx)(l.FormattedMessage,{id:"design.upload"})},"upload")]},actionRef:T,rowKey:"package",search:!1,request:function(s){return(0,g.Be)(s)},columnsState:{persistenceKey:"design-table",persistenceType:"localStorage"},pagination:!1,columns:ee},G),S&&(0,e.jsxs)(D.Y,{width:600,title:a.formatMessage({id:"design.upload"}),open:S,modalProps:{onCancel:function(){U(!1)}},onFinish:M()(v()().mark(function _(){return v()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:U(!1);case 1:case"end":return t.stop()}},_)})),children:[(0,e.jsx)(B.Z,{name:"tpl",label:a.formatMessage({id:"design.package.zip"}),children:(0,e.jsx)(Z.Z,{name:"file",showUploadList:!1,accept:".zip",customRequest:H,children:(0,e.jsx)(c.ZP,{type:"primary",children:(0,e.jsx)(l.FormattedMessage,{id:"design.package.zip.select"})})})}),(0,e.jsx)("div",{children:(0,e.jsx)("p",{children:a.formatMessage({id:"design.package.zip.tips"})})})]})]})};y.default=p}}]);
