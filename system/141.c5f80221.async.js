"use strict";(self.webpackChunkAnQiCMS=self.webpackChunkAnQiCMS||[]).push([[141],{39651:function(tn,B,e){var V=e(54203),v=e(99944),G=e(76979),A=e(52676),Z=function(){};Z.show=function(x){var L=new Promise(function(H,U){var T=[],p,h=function(D){x?T=D:(p(),H(D))},z=function(){p(),U()},O=function(){x&&H(T),p()},w=V.Z.info({icon:null,maskClosable:!0,width:800,wrapClassName:"attachment-dialog",content:(0,A.jsx)(v.Z,{onSelect:h,onCancel:function(){return z()},multiple:x}),okText:"OK",onCancel:function(){z()},onOk:function(){O()}}),K=w.destroy;p=K});return L},B.Z=Z},30141:function(tn,B,e){e.d(B,{Z:function(){return pn}});var V=e(90228),v=e.n(V),G=e(87999),A=e.n(G),Z=e(48305),x=e.n(Z),L=e(75304),H=e(18470),U=e(22683),T=e(97395),p=e(32064),h=e(34206),z=e(12964),O=e(75271),w=e(27669),K=e(98991),r=e.n(K),D=e(37127),en=e.n(D),an=e(39651),on=e(17069),Q=e.n(on),ln=e(25298),Y=e.n(ln),sn=e(62657),y=e.n(sn),cn=e(21742),J=e.n(cn),rn=e(83136),X=e.n(rn),dn=e(82092),I=e.n(dn),fn=r().BtnMenu,un=function(i){J()(s,i);var j=X()(s);function s(P){var a;Y()(this,s);var S=r().$(`<div class="w-e-menu" data-title="Code">
      <svg viewBox="64 64 896 896" focusable="false" data-icon="right-square" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M412.7 696.5l246-178c4.4-3.2 4.4-9.7 0-12.9l-246-178c-5.3-3.8-12.7 0-12.7 6.5V381c0 10.2 4.9 19.9 13.2 25.9L558.6 512 413.2 617.2c-8.3 6-13.2 15.6-13.2 25.9V690c0 6.5 7.4 10.3 12.7 6.5z"></path><path d="M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"></path></svg>
      </div>`);return a=j.call(this,S,P),I()(y()(a),"htmlMode",!1),I()(y()(a),"clickHandler",function(){var f=a.editor.config,c=f.setMode,M=f.customSetMode;c&&c(!a.htmlMode),a.htmlMode?a.htmlMode=!1:a.htmlMode=!0,M&&M(function(C){a.htmlMode=C,c(a.htmlMode),a.tryChangeActive()}),a.tryChangeActive()}),I()(y()(a),"tryChangeActive",function(){a.htmlMode?a.active():a.unActive()}),a}return Q()(s)}(fn),k=e(77641),vn=e(13297),mn=e(25689),hn=e(1462),b=e(54203),gn=e(53745),q=e(21261),l=e(52676),Mn=r().BtnMenu,Cn=function(i){J()(s,i);var j=X()(s);function s(P){var a;Y()(this,s);var S=r().$(`<div class="w-e-menu" data-title="Material">
      <svg viewBox="64 64 896 896" focusable="false" data-icon="reconciliation" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M676 623c-18.8 0-34 15.2-34 34s15.2 34 34 34 34-15.2 34-34-15.2-34-34-34zm204-455H668c0-30.9-25.1-56-56-56h-80c-30.9 0-56 25.1-56 56H264c-17.7 0-32 14.3-32 32v200h-88c-17.7 0-32 14.3-32 32v448c0 17.7 14.3 32 32 32h336c17.7 0 32-14.3 32-32v-16h368c17.7 0 32-14.3 32-32V200c0-17.7-14.3-32-32-32zM448 848H176V616h272v232zm0-296H176v-88h272v88zm20-272v-48h72v-56h64v56h72v48H468zm180 168v56c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8v-56c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8zm28 301c-50.8 0-92-41.2-92-92s41.2-92 92-92 92 41.2 92 92-41.2 92-92 92zm92-245c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8v-96c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v96zm-92 61c-50.8 0-92 41.2-92 92s41.2 92 92 92 92-41.2 92-92-41.2-92-92-92zm0 126c-18.8 0-34-15.2-34-34s15.2-34 34-34 34 15.2 34 34-15.2 34-34 34z"  fill="#595959"></path></svg>
      </div>`);return a=j.call(this,S,P),I()(y()(a),"clickHandler",A()(v()().mark(function f(){var c,M,C,E;return v()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,(0,k._7)();case 2:c=o.sent,M=(c.data||[]).reduce(function(n,t){return n[t.id]=t.title,n},[]),C=null,E=function(t){a.editor.cmd.do("insertHTML",'<div data-w-e-type="material" data-w-e-is-void data-material="'.concat(t.id,'" data-title="').concat(t.title,'">').concat(t.content,"</div><p><br/></p>")),C.destroy()},C=b.Z.confirm({width:800,icon:null,title:!1,okButtonProps:{className:"hidden"},className:"material-modal",onOk:function(){},content:(0,l.jsx)(hn.Rs,{className:"material-table",rowKey:"id",request:function(t){return(0,k.c2)(t)},pagination:{defaultPageSize:6},showActions:"hover",showExtra:"hover",search:{span:12,labelWidth:120},metas:{title:{search:!1,dataIndex:"title"},description:{dataIndex:"content",search:!1,render:function(t){return(0,l.jsx)("div",{className:"material-description",dangerouslySetInnerHTML:{__html:t}})}},subTitle:{search:!1,render:function(t,d){return(0,l.jsxs)(gn.Z,{size:0,children:[(0,l.jsxs)(q.Z,{className:"link",onClick:function(){a.previewDetail(d)},children:[(0,l.jsx)(vn.Z,{})," Preview"]}),(0,l.jsxs)(q.Z,{color:"blue",className:"link",onClick:function(){E(d)},children:[(0,l.jsx)(mn.Z,{})," Use"]})]})}},category_id:{title:"Category",valueType:"select",valueEnum:M}}})});case 7:case"end":return o.stop()}},f)}))),I()(y()(a),"tryChangeActive",function(){a.isActive?a.active():a.unActive()}),I()(y()(a),"previewDetail",function(f){b.Z.info({title:f.title,icon:null,width:600,content:(0,l.jsx)("div",{dangerouslySetInnerHTML:{__html:f.content}})})}),a}return Q()(s)}(Mn);r().registerMenu("html",un),r().registerMenu("material",Cn);var R,g={},xn=(0,O.forwardRef)(function(i,j){var s=(0,O.useRef)(null),P=(0,O.useState)(!1),a=x()(P,2),S=a[0],f=a[1],c=(0,p.useIntl)();function M(o){var n;(n=s.current)===null||n===void 0||n.editor.txt.html(o)}(0,O.useImperativeHandle)(j,function(){return{setInnerContent:M}});var C=function(n){for(var t in n)if(n.hasOwnProperty(t)){var d,m='<a href="'.concat(n[t].logo,'" target="_blank">').concat(n[t].file_name,"</a>");n[t].is_image||n[t].file_location.indexOf(".webp")!==-1||n[t].file_location.indexOf(".bmp")!==-1||n[t].file_location.indexOf(".png")!==-1||n[t].file_location.indexOf(".gif")!==-1||n[t].file_location.indexOf(".jpg")!==-1||n[t].file_location.indexOf(".jpeg")!==-1||n[t].file_location.indexOf(".svg")!==-1?m='<img src="'.concat(n[t].logo,'" alt="').concat(n[t].file_name,'"/>'):n[t].file_location.indexOf(".mp4")!==-1||n[t].file_location.indexOf(".ogg")!==-1||n[t].file_location.indexOf(".webm")!==-1?m='<video controls="controls" controlslist="nodownload" poster=""><source src="'.concat(n[t].logo,'" type="video/').concat(n[t].file_location.substr(n[t].file_location.lastIndexOf(".")+1),'">').concat(c.formatMessage({id:"component.markdown.video.unsupport"}),"</video>"):(n[t].file_location.indexOf(".mp3")!==-1||n[t].file_location.indexOf(".wav")!==-1)&&(m='<audio src="'.concat(n[t].logo,'" controls="controls"><source src="').concat(n[t].logo,'" type="audio/').concat(n[t].file_location.substr(n[t].file_location.lastIndexOf(".")+1),'">').concat(c.formatMessage({id:"component.markdown.audio.unsupport"}),"</audio>")),(d=s.current)===null||d===void 0||d.editor.cmd.do("insertHTML",m)}},E=function(n){g[i.field]!==n&&(g[i.field]=n,i.setContent(g[i.field]))},_=function(){var o=A()(v()().mark(function n(t,d){var m,W;return v()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:m=v()().mark(function On(){var nn,$;return v()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:t.hasOwnProperty(W)&&(nn=h.ZP.loading(c.formatMessage({id:"component.editor.inserting"}),0),$=new FormData,$.append("file",t[W]),(0,L.pD2)($).then(function(N){N.code!==0?h.ZP.info(N.msg):(h.ZP.info(N.msg||c.formatMessage({id:"component.footer.uploaded"})),d(N.data.logo))}).finally(function(){nn()}));case 1:case"end":return F.stop()}},On)}),u.t0=v()().keys(t);case 2:if((u.t1=u.t0()).done){u.next=7;break}return W=u.t1.value,u.delegateYield(m(),"t2",5);case 5:u.next=2;break;case 7:case"end":return u.stop()}},n)}));return function(t,d){return o.apply(this,arguments)}}();return(0,l.jsxs)("div",{className:"editor-container "+i.className,style:{border:"1px solid #ccc",marginTop:"10px"},children:[(0,l.jsx)(en(),{ref:s,defaultValue:i.content,config:{height:500,customUploadImg:function(n,t){_(n,t)},uploadImgAccept:["jpg","jpeg","png","gif","webp"],uploadImgFromMedia:function(){an.Z.show(!0).then(function(n){C(n)})},uploadVideoServer:H.Z.baseUrl+"/attachment/upload",uploadVideoAccept:["mp4"],uploadVideoName:"file",uploadVideoHeaders:{admin:(0,U.bh)("adminToken")},uploadVideoHooks:{customInsert:function(n,t){var d=t.data||{};t.code!==0?h.ZP.info(t.msg):(h.ZP.info(t.msg||c.formatMessage({id:"component.footer.uploaded"})),n(d.logo))}},customSetMode:function(n){R=n},setMode:function(n){if(f(n),!n){var t;(t=s.current)===null||t===void 0||t.editor.txt.html(g[i.field])}}},onChange:function(n){i.setContent(n),g[i.field]=n},onBlur:function(n){g[i.field]=n}}),(0,l.jsxs)("div",{style:{display:S?"block":"none"},className:"tmp-editor",children:[(0,l.jsx)("div",{className:"html-menus",children:(0,l.jsx)("div",{className:"menu-item",onClick:function(){R&&R(!1),f(!1)},children:(0,l.jsx)(z.Z,{title:c.formatMessage({id:"component.editor.mode.return-view"}),children:(0,l.jsx)(T.Z,{className:"icon"})})})}),S&&(0,l.jsx)(w.ZP,{height:563,language:"markdown",theme:"vs-dark",value:g[i.field],options:{selectOnLineNumbers:!1,wordWrap:"on"},onChange:E,editorDidMount:function(){}})]})]})}),pn=xn}}]);
