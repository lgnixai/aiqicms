(self.webpackChunkAnQiCMS=self.webpackChunkAnQiCMS||[]).push([[634],{41265:function(z,V,r){"use strict";var A=r(18201),k=r(66342),j=r(59831),n=r(75271),R=r(38465),f=r(31945),L=r(52676),F=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],H=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],M=function(d,B){var Z=d.fieldProps,y=d.children,X=d.params,G=d.proFieldProps,e=d.mode,O=d.valueEnum,T=d.request,D=d.showSearch,h=d.options,$=(0,k.Z)(d,F),de=(0,n.useContext)(R.Z);return(0,L.jsx)(f.Z,(0,A.Z)((0,A.Z)({valueEnum:(0,j.h)(O),request:T,params:X,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,A.Z)({options:h,mode:e,showSearch:D,getPopupContainer:de.getPopupContainer},Z),ref:B,proFieldProps:G},$),{},{children:y}))},w=n.forwardRef(function(_,d){var B=_.fieldProps,Z=_.children,y=_.params,X=_.proFieldProps,G=_.mode,e=_.valueEnum,O=_.request,T=_.options,D=(0,k.Z)(_,H),h=(0,A.Z)({options:T,mode:G||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},B),$=(0,n.useContext)(R.Z);return(0,L.jsx)(f.Z,(0,A.Z)((0,A.Z)({valueEnum:(0,j.h)(e),request:O,params:y,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,A.Z)({getPopupContainer:$.getPopupContainer},h),ref:d,proFieldProps:X},D),{},{children:Z}))}),x=n.forwardRef(M),Q=w,u=x;u.SearchSelect=Q,u.displayName="ProFormComponent",V.Z=u},85606:function(z,V,r){"use strict";var A=r(48305),k=r.n(A),j=r(75304),n=r(22683),R=r(96570),f=r(75271),L=r(52676),F=function(M){var w=(0,f.useState)(void 0),x=k()(w,2),Q=x[0],u=x[1],_=(0,f.useState)(""),d=k()(_,2),B=d[0],Z=d[1],y=function(){(0,j.roP)({type:"multi"}).then(function(e){var O=(e.data||[]).map(function($){return{key:$.id,tab:$.name,is_main:$.is_main}});u(O);var T=(0,n.KJ)("sub-site-id");!T&&O.length>0&&(T=O[0].key+"");var D=O.find(function($){return $.key===Number(T)}),h=!1;D&&(h=!0,D.is_main&&(h=!1)),(0,n.Xq)("is-sub-site",h),Z(T)})};(0,f.useEffect)(function(){y()},[]);var X=function(e){var O;Z(e),(0,n.Xq)("sub-site-id",e);var T=Q.find(function(h){return h.key===Number(e)}),D=!0;T.is_main&&(D=!1),(0,n.Xq)("is-sub-site",D),(O=M.onTabChange)===null||O===void 0||O.call(M,e,D)};return(0,L.jsx)(R._z,{tabList:Q,tabActiveKey:B,onTabChange:X,title:M.title,children:M.children})};V.Z=F},58721:function(z,V,r){"use strict";r.r(V),r.d(V,{default:function(){return de}});var A=r(335),k=r.n(A),j=r(90228),n=r.n(j),R=r(87999),f=r.n(R),L=r(48305),F=r.n(L),H=r(85606),M=r(75304),w=r(16621),x=r(41265),Q=r(18640),u=r(32064),_=r(54203),d=r(34206),B=r(53745),Z=r(47634),y=r(75271),X=r(35937),G=r(66857),e=r(52676),O=function(c){var N,q,J,se,ee=y.createRef(),ce=(0,y.useState)({}),te=F()(ce,2),Ce=te[0],me=te[1],W=(0,u.useIntl)(),ae=function(m){var o=k()(c.modules),S;try{for(o.s();!(S=o.n()).done;){var b=S.value;if(b.id===m){me(b);break}}}catch(K){o.e(K)}finally{o.f()}};(0,y.useEffect)(function(){var E,m=((E=c.category)===null||E===void 0?void 0:E.module_id)||1;ae(m)},[]);var re=function(){var E=f()(n()().mark(function m(o){var S,b,K,g,oe,Y,le;return n()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:S={parent_id:o.parent_id,module_id:o.module_id,type:c.type,title:"",url_token:"",status:1},b=o.inputs.split(`
`),K=k()(b),C.prev=3,K.s();case 5:if((g=K.n()).done){C.next=18;break}if(oe=g.value,Y=oe.trim().split("|"),S.title=Y[0],S.url_token="",Y.length>1&&(S.url_token=Y[1]),!(S.title.length>0)){C.next=16;break}return C.next=14,(0,M._zR)(S);case 14:le=C.sent,d.ZP.info(le.msg);case 16:C.next=5;break;case 18:C.next=23;break;case 20:C.prev=20,C.t0=C.catch(3),K.e(C.t0);case 23:return C.prev=23,K.f(),C.finish(23);case 26:c.onSubmit();case 27:case"end":return C.stop()}},m,null,[[3,20,23,26]])}));return function(o){return E.apply(this,arguments)}}();return(0,e.jsxs)(X.Y,{formRef:ee,width:600,title:W.formatMessage({id:"content.category.batch-add"}),initialValues:c.category,open:c.open,layout:"horizontal",onOpenChange:function(m){m||c.onCancel(m)},onFinish:function(){var E=f()(n()().mark(function m(o){return n()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:re(o);case 1:case"end":return b.stop()}},m)}));return function(m){return E.apply(this,arguments)}}(),children:[(0,e.jsx)(x.Z,{label:W.formatMessage({id:"content.module.name"}),name:"module_id",width:"lg",request:f()(n()().mark(function E(){return n()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",c.modules);case 1:case"end":return o.stop()}},E)})),readonly:!!((N=c.category)!==null&&N!==void 0&&N.id||((q=c.category)===null||q===void 0?void 0:q.module_id)>0),fieldProps:{fieldNames:{label:"name",value:"id"},onChange:function(m){ae(m)}}}),(0,e.jsx)(x.Z,{label:W.formatMessage({id:"content.category.top"}),name:"parent_id",width:"lg",request:f()(n()().mark(function E(){var m,o,S,b;return n()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,(0,M.CPB)({type:c.type});case 2:if(m=g.sent,o=m.data||[],!c.category.id){g.next=15;break}S=[],g.t0=n()().keys(o);case 7:if((g.t1=g.t0()).done){g.next=14;break}if(b=g.t1.value,!(o[b].id===c.category.id||o[b].parent_id===c.category.id||o[b].module_id!==c.category.module_id)){g.next=11;break}return g.abrupt("continue",7);case 11:S.push(o[b]),g.next=7;break;case 14:o=S;case 15:return o=[{id:0,title:W.formatMessage({id:"content.category.top"}),spacer:""}].concat(o),g.abrupt("return",o);case 17:case"end":return g.stop()}},E)})),readonly:!((J=c.category)!==null&&J!==void 0&&J.id||((se=c.category)===null||se===void 0?void 0:se.module_id)>0),fieldProps:{fieldNames:{label:"title",value:"id"},optionItemRender:function(m){return(0,e.jsx)("div",{dangerouslySetInnerHTML:{__html:(m.spacer||"")+m.title}})}}}),(0,e.jsx)(G.Z,{name:"inputs",width:"lg",label:W.formatMessage({id:"content.category.batch-name"}),placeholder:W.formatMessage({id:"content.category.batch-name.placeholder"}),fieldProps:{rows:10},extra:(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:(0,e.jsx)(u.FormattedMessage,{id:"content.category.batch-name.tips1"})}),(0,e.jsx)("div",{children:(0,e.jsx)(u.FormattedMessage,{id:"content.category.batch-name.tips2"})}),(0,e.jsx)("div",{children:(0,e.jsx)("code",{children:(0,e.jsxs)("div",{children:[(0,e.jsx)(u.FormattedMessage,{id:"content.category.batch-name.tips3"}),(0,e.jsx)("br",{}),(0,e.jsx)(u.FormattedMessage,{id:"content.category.batch-name.tips4"})]})})})]})})]})},T=O,D=r(32639),h={},$=function(){var c=(0,y.useRef)(),N=(0,y.useRef)(),q=(0,y.useState)([]),J=F()(q,2),se=J[0],ee=J[1],ce=(0,y.useState)({}),te=F()(ce,2),Ce=te[0],me=te[1],W=(0,y.useState)([]),ae=F()(W,2),re=ae[0],E=ae[1],m=(0,y.useState)(0),o=F()(m,2),S=o[0],b=o[1],K=(0,y.useState)(!1),g=F()(K,2),oe=g[0],Y=g[1],le=(0,y.useState)(!1),fe=F()(le,2),C=fe[0],he=fe[1],Fe=(0,y.useState)(""),Me=F()(Fe,2),_e=Me[0],xe=Me[1],Oe=(0,y.useState)(!1),Se=F()(Oe,2),ve=Se[0],Ae=Se[1],v=(0,u.useIntl)(),be=function(){var s=f()(n()().mark(function a(){var t;return n()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,(0,M.hUj)();case 2:t=i.sent,E(t.data||[]);case 4:case"end":return i.stop()}},a)}));return function(){return s.apply(this,arguments)}}(),Ze=function(a,t){be().then(function(){xe(a),Ae(t)})};(0,y.useEffect)(function(){b(h.module_id),be()},[]);var pe=function(a){var t,l;h.module_id=a,b(a),(t=N.current)===null||t===void 0||t.setFieldsValue({module_id:a,category_id:0}),u.history.replace("/archive/category?module_id="+a),(l=N.current)===null||l===void 0||l.submit()},ke=function(a){var t=a;if(oe)h=t,t.module_id!==S&&pe(t.module_id);else{var l;Y(!0);var i=new URLSearchParams(window.location.search);h.module_id=Number(i.get("module_id")||0),h.category_id=Number(i.get("category_id")||0),h.status=i.get("status")||"ok",(l=N.current)===null||l===void 0||l.setFieldsValue(h),t=h}return t},Pe=function(){var s=f()(n()().mark(function a(t){return n()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:_.Z.confirm({title:v.formatMessage({id:"content.category.delete.confirm"}),onOk:function(){var P=f()(n()().mark(function ne(){var ue,I,ye,ie,Ee,Ie;return n()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(ue=d.ZP.loading(v.formatMessage({id:"content.delete.deletting"}),0),t){p.next=3;break}return p.abrupt("return",!0);case 3:p.prev=3,ie=k()(t),p.prev=5,ie.s();case 7:if((Ee=ie.n()).done){p.next=13;break}return Ie=Ee.value,p.next=11,(0,M.uuc)({id:Ie});case 11:p.next=7;break;case 13:p.next=18;break;case 15:p.prev=15,p.t0=p.catch(5),ie.e(p.t0);case 18:return p.prev=18,ie.f(),p.finish(18);case 21:return ue(),d.ZP.success(v.formatMessage({id:"content.delete.success"})),ee([]),(I=c.current)===null||I===void 0||(ye=I.reloadAndRest)===null||ye===void 0||ye.call(I),p.abrupt("return",!0);case 28:return p.prev=28,p.t1=p.catch(3),ue(),d.ZP.error(v.formatMessage({id:"content.delete.failure"})),p.abrupt("return",!0);case 33:case"end":return p.stop()}},ne,null,[[3,28],[5,15,18,21]])}));function U(){return P.apply(this,arguments)}return U}()});case 1:case"end":return i.stop()}},a)}));return function(t){return s.apply(this,arguments)}}(),we=function(a){_.Z.confirm({title:v.formatMessage({id:"content.option.batch-add-anchor.confirm"}),onOk:function(){var t=f()(n()().mark(function i(){var P,U,ne;return n()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(P=d.ZP.loading(v.formatMessage({id:"setting.system.submitting"}),0),a){I.next=3;break}return I.abrupt("return",!0);case 3:return I.prev=3,I.next=6,(0,M.o9V)({type:"category",ids:a});case 6:return P(),d.ZP.success(v.formatMessage({id:"content.submit.success"})),ee([]),(U=c.current)===null||U===void 0||(ne=U.reloadAndRest)===null||ne===void 0||ne.call(U),I.abrupt("return",!0);case 13:return I.prev=13,I.t0=I.catch(3),P(),d.ZP.error(v.formatMessage({id:"content.submit.failure"})),I.abrupt("return",!0);case 18:case"end":return I.stop()}},i,null,[[3,13]])}));function l(){return t.apply(this,arguments)}return l}()})},ge=function(){var s=f()(n()().mark(function a(t){return n()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:u.history.push("/archive/category/detail?id="+(t.id||"new")+"&parent_id="+t.parent_id);case 1:case"end":return i.stop()}},a)}));return function(t){return s.apply(this,arguments)}}(),je=function(){var s=f()(n()().mark(function a(t){return n()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:me(t),he(!0);case 2:case"end":return i.stop()}},a)}));return function(t){return s.apply(this,arguments)}}(),Te=function(a){u.history.push("/archive/list?category_id="+a.id)},De=function(a){var t=k()(re),l;try{for(t.s();!(l=t.n()).done;){var i=l.value;if(a===i.id)return i.name}}catch(P){t.e(P)}finally{t.f()}return null},$e=function(){_.Z.confirm({title:v.formatMessage({id:"content.category.update-count.confirm"}),content:v.formatMessage({id:"content.category.update-count.description"}),onOk:function(){var t=d.ZP.loading(v.formatMessage({id:"setting.system.submitting"}),0);(0,M.xEH)({}).then(function(l){var i,P;d.ZP.info(l.msg),(i=c.current)===null||i===void 0||(P=i.reload)===null||P===void 0||P.call(i)}).finally(function(){t()})}})},Ke=[{title:"ID",dataIndex:"id",hideInSearch:!0},{title:v.formatMessage({id:"content.sort.name"}),dataIndex:"sort",hideInSearch:!0},{title:v.formatMessage({id:"content.category.title"}),dataIndex:"title",filters:!0,render:function(a,t){return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"spacer",dangerouslySetInnerHTML:{__html:t.spacer}}),(0,e.jsx)("a",{href:t.link,target:"_blank",children:a})]})}},{title:v.formatMessage({id:"content.module.name"}),dataIndex:"module_id",render:function(a,t){return De(t.module_id)},renderFormItem:function(){return(0,e.jsx)(x.Z,{name:"module_id",request:f()(n()().mark(function a(){var t,l;return n()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,(0,M.hUj)({});case 2:return t=P.sent,l=[{name:v.formatMessage({id:"content.archive.all"}),id:0}].concat(t.data||[]).map(function(U){return{label:U.name,value:U.id}}),P.abrupt("return",l);case 5:case"end":return P.stop()}},a)}))})}},{title:v.formatMessage({id:"content.category.template"}),dataIndex:"template",hideInSearch:!0},{title:v.formatMessage({id:"content.archive-template.name"}),dataIndex:"detail_template",hideInSearch:!0},{title:v.formatMessage({id:"content.category.archive-count"}),dataIndex:"archive_count",hideInSearch:!0},{title:v.formatMessage({id:"content.category.status"}),dataIndex:"status",hideInSearch:!0,valueEnum:{0:{text:v.formatMessage({id:"content.category.status.hide"}),status:"Default"},1:{text:v.formatMessage({id:"content.category.status.ok"}),status:"Success"}}},{title:v.formatMessage({id:"setting.action"}),dataIndex:"option",valueType:"option",render:function(a,t){return(0,e.jsxs)(B.Z,{size:20,children:[(0,e.jsx)("a",{onClick:function(){Te(t)},children:(0,e.jsx)(u.FormattedMessage,{id:"menu.archive.list"})},"list"),!ve&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("a",{onClick:function(){ge({parent_id:t.id,module_id:t.module_id,status:1})},children:(0,e.jsx)(u.FormattedMessage,{id:"content.category.add-children"})},"add-child"),(0,e.jsx)("a",{onClick:function(){je({parent_id:t.id,module_id:t.module_id,status:1})},children:(0,e.jsx)(u.FormattedMessage,{id:"content.category.batch-add-children"})},"add")]}),(0,e.jsx)("a",{onClick:function(){ge(t)},children:(0,e.jsx)(u.FormattedMessage,{id:"setting.action.edit"})},"edit"),(0,e.jsx)("a",{className:"text-red",onClick:function(){Pe([t.id])},children:(0,e.jsx)(u.FormattedMessage,{id:"setting.system.delete"})},"delete")]})}}];return(0,e.jsxs)(H.Z,{onTabChange:Ze,children:[(0,e.jsx)(Q.Z,{headerTitle:(0,e.jsxs)("div",{className:"module-tags",children:[(0,e.jsx)("div",{className:"module-tag "+(S===0?"active":""),onClick:function(){pe(0)},children:(0,e.jsx)(u.FormattedMessage,{id:"menu.archive.category"})}),re.map(function(s){return(0,e.jsx)("div",{className:"module-tag "+(s.id===S?"active":""),onClick:function(){pe(s.id)},children:s.name},s.id)})]}),actionRef:c,rowKey:"id",search:{span:{xs:24,sm:12,md:8,lg:8,xl:8,xxl:8},defaultCollapsed:!1},formRef:N,form:{initialValues:h},beforeSearchSubmit:ke,toolBarRender:function(){return[(0,e.jsx)(Z.ZP,{onClick:function(){$e()},children:(0,e.jsx)(u.FormattedMessage,{id:"content.category.update-count.name"})},"count"),!ve&&(0,e.jsx)(Z.ZP,{onClick:function(){je({parent_id:0,module_id:null,status:1})},children:(0,e.jsx)(u.FormattedMessage,{id:"content.category.batch-add"})},"add"),!ve&&(0,e.jsxs)(Z.ZP,{type:"primary",onClick:function(){ge({parent_id:0,module_id:null,status:1})},children:[(0,e.jsx)(w.Z,{})," ",(0,e.jsx)(u.FormattedMessage,{id:"content.category.batch-add-top"})]},"add")]},tableAlertOptionRender:function(a){var t=a.selectedRowKeys,l=a.onCleanSelected;return(0,e.jsxs)(B.Z,{children:[(0,e.jsx)(Z.ZP,{size:"small",onClick:function(){return we(t)},children:(0,e.jsx)(u.FormattedMessage,{id:"content.option.batch-add-anchor"})}),(0,e.jsx)(Z.ZP,{size:"small",onClick:function(){Pe(t)},children:(0,e.jsx)(u.FormattedMessage,{id:"content.option.batch-delete"})}),(0,e.jsx)(Z.ZP,{type:"link",size:"small",onClick:l,children:(0,e.jsx)(u.FormattedMessage,{id:"content.option.cancel-select"})})]})},request:function(a){return a.type=1,a.show_type=1,h=a,(0,M.CPB)(a)},columnsState:{persistenceKey:"category-table",persistenceType:"localStorage"},columns:Ke,rowSelection:{onChange:function(a){ee(a)}},pagination:{showSizeChanger:!0,defaultCurrent:h.current,defaultPageSize:h.pageSize}},_e),C&&(0,e.jsx)(T,{open:C,category:Ce,modules:re,type:1,onCancel:function(){he(!1)},onSubmit:f()(n()().mark(function s(){return n()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:he(!1),c.current&&c.current.reload();case 2:case"end":return t.stop()}},s)}))})]})},de=$},32639:function(){"use strict"},335:function(z,V,r){var A=r(31479);function k(j,n){var R=typeof Symbol!="undefined"&&j[Symbol.iterator]||j["@@iterator"];if(!R){if(Array.isArray(j)||(R=A(j))||n&&j&&typeof j.length=="number"){R&&(j=R);var f=0,L=function(){};return{s:L,n:function(){return f>=j.length?{done:!0}:{done:!1,value:j[f++]}},e:function(x){throw x},f:L}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var F=!0,H=!1,M;return{s:function(){R=R.call(j)},n:function(){var x=R.next();return F=x.done,x},e:function(x){H=!0,M=x},f:function(){try{!F&&R.return!=null&&R.return()}finally{if(H)throw M}}}}z.exports=k,z.exports.__esModule=!0,z.exports.default=z.exports}}]);
